{
  "version": 3,
  "sources": ["../src/index.ts", "../src/Danmaku.ts", "../src/Track.ts", "../src/DanmakuEngine.ts"],
  "sourcesContent": ["export function hello(word: string) {\r\n  console.log('hello123')\r\n  return word\r\n}\r\n\r\nexport {DanmakuEngine} from './DanmakuEngine';\r\nexport * from './Track';\r\nexport * from './Danmaku';", "import { Track } from \"./Track\"\r\n\r\ntype DanmakuPosition = {\r\n  x: number\r\n  y: number\r\n}\r\n\r\ntype DanmakuRect = {\r\n  width: number\r\n  height: number\r\n}\r\nexport class Danmaku {\r\n  public element: HTMLElement | null = null\r\n  public parentTrack: Track | null = null\r\n  public animationID: number | null = null\r\n  public position: DanmakuPosition | null = null\r\n  public rect: DanmakuRect | null = null\r\n  public speedPerFrame = 0.5\r\n\r\n  constructor(track: Track, text: string) {\r\n    this.#initDanmaku(track, text)\r\n  }\r\n\r\n  #initDanmaku(track: Track, text: string) {\r\n    this.parentTrack = track\r\n    this.position = {\r\n      x: this.parentTrack.width,\r\n      y: this.parentTrack.index * this.parentTrack.height\r\n    }\r\n    this.element = document.createElement('div')\r\n    this.element.innerText = text\r\n    this.parentTrack.container.appendChild(this.element)\r\n\r\n    this.rect = {\r\n      width: this.element.clientWidth,\r\n      height: this.element.clientHeight\r\n    }\r\n    this.element.style.position = 'absolute'\r\n    this.element.style.left = `${this.position.x}px`\r\n    this.element.style.top = `${this.position.y}px`\r\n  }\r\n  startMove() {\r\n    let startX = 0\r\n    const run = () => {\r\n      this.animationID = requestAnimationFrame(() => {\r\n        if (!this.element || !this.parentTrack || !this.rect) return\r\n        this.element.style.transform = `translateX(${startX}px)`\r\n        startX -= this.speedPerFrame\r\n        // debugger\r\n        if (startX < -this.parentTrack.width - this.rect.width - 50) {\r\n          this.destroy()\r\n          return\r\n        }\r\n        run()\r\n      })\r\n    }\r\n    run()\r\n  }\r\n\r\n  stopMove() {\r\n    if (this.animationID) {\r\n      cancelAnimationFrame(this.animationID)\r\n      this.animationID = null\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n    this.stopMove()\r\n    this.element?.remove()\r\n  }\r\n}", "import { Danmaku } from \"./Danmaku\"\r\n\r\nexport type TrackOptions = {\r\n  height: number\r\n  width: number\r\n  index: number\r\n  container: HTMLElement\r\n}\r\n\r\nexport class Track {\r\n  public height: number\r\n  public width: number\r\n  public index: number\r\n  public container: HTMLElement\r\n  public isLocked: boolean = false\r\n\r\n  constructor(trackOptions: TrackOptions) {\r\n    this.height = trackOptions.height\r\n    this.width = trackOptions.width\r\n    this.index = trackOptions.index\r\n    this.container = trackOptions.container\r\n  }\r\n\r\n  send(text: string) {\r\n    this.isLocked = true\r\n    const danmaku = new Danmaku(this, text)\r\n    danmaku.startMove()\r\n  }\r\n}", "import { Track } from \"./Track\"\r\n\r\nexport type DanmakuEngineOptions = {\r\n  antiOcclusion?: boolean\r\n}\r\nexport class DanmakuEngine {\r\n  public container: HTMLElement\r\n  public tracks: Track[] = []\r\n  public cacheStack: string[] = []\r\n  public isPlaying: boolean = false\r\n  public interval: number | null = null\r\n  constructor(parentContainer: HTMLElement, options: DanmakuEngineOptions) {\r\n    this.container = document.createElement('div')\r\n    this.container.style.position = 'relative'\r\n    this.container.style.height = '100%'\r\n    this.container.style.width = '100%'\r\n    this.container.style.display = 'flex'\r\n    parentContainer.appendChild(this.container)\r\n    this.container.style.backgroundColor = 'transparent'\r\n    this.#initTracks()\r\n\r\n  }\r\n\r\n  startPlaying() {\r\n    if (this.isPlaying) {\r\n      return\r\n    }\r\n    this.isPlaying = true\r\n    this.interval = setInterval(() => {\r\n      console.log(\"interval\", this.cacheStack, Math.random());\r\n\r\n      if (this.cacheStack.length) {\r\n        const text = this.cacheStack.shift()\r\n        if (text) {\r\n          const track = this.tracks.find(track => !track.isLocked)\r\n          if (track) {\r\n            console.log(track);\r\n\r\n            track.send(text)\r\n          }\r\n        }\r\n      }\r\n    }, 500)\r\n  }\r\n\r\n  stopPlaying() {\r\n    this.isPlaying = false\r\n    if (this.interval) {\r\n      clearInterval(this.interval)\r\n      this.interval = null\r\n    }\r\n  }\r\n\r\n  send(text: string) {\r\n    this.cacheStack.push(text)\r\n  }\r\n\r\n  #initTracks() {\r\n    const trackCount = 5\r\n    for (let i = 0; i < trackCount; i++) {\r\n      const track = new Track({\r\n        height: 32,\r\n        width: this.container.clientWidth,\r\n        index: i,\r\n        container: this.container\r\n      })\r\n      this.tracks.push(track)\r\n    }\r\n  }\r\n}"],
  "mappings": "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",
  "names": ["track"]
}
